# 📄 白蚁智能监测平台小程序需求文档说明 (v2.0)

## 1. 概述

### 1.1 项目目标
开发一款微信小程序，配合物联网（IoT）白蚁监测设备，实现对水库等基础设施周边白蚁活动的**实时、远程、可视化**监测和管理。旨在提高运维效率，及时预警，保护水利设施安全。

### 1.2 目标用户
*   **超级管理员 (Admin)：** 系统级最高权限，负责所有项目管理、账号审核及全局配置。
*   **项目负责人 (Manager)：** 负责特定项目的统筹，查看统计报表，接收超时警报通知，关注宏观数据统计、项目健康状态。（首次注册时需要超级管理员提供的随机验证码（6位随机数字），后续可以正常登录）
*   **运维人员 (Operator)：** 一线作业人员，负责设备安装、巡检、接收并处理警报。**（仅能查看被分配的项目，不能添加修改项目）** （首次注册时需要 超级管理员提供随机验证码（6位随机数字），后续可以正常登录）


### 1.3 术语定义
| 术语 | 定义 |
| :--- | :--- |
| **项目** | 特指一个或一组被监测的水库区域。 |
| **设备** | 指安装在项目区域的物联网白蚁监测传感器单元。 |
| **警报** | 特指设备通过咬食传感器触发的白蚁活动信号。 |
| **SN** | 设备序列号（Serial Number），设备的唯一识别码。 |
| **数据隔离** | 指不同项目的运维人员只能查看和操作自己所属项目的数据。 |
-----

## 2. 功能需求详情

### 2.1 用户与权限模块 (Auth & RBAC)

| ID | 功能名称 | 优先级 | 详细需求说明 |
| :--- | :--- | :--- | :--- |
| U-1 | **用户登录** | 必需 | 支持账号/手机号+密码登录。登录后根据 Token 自动获取角色权限，可以选择登录角色。 |
| U-2 | **权限控制** | 必需 | 根据用户角色，限制其对“项目管理”、“设备注册”和“数据统计”等页面的访问。 |
| U-3 | **数据权限隔离** | **核心** | **运维人员**登录后，仅展示其被分配的项目及该项目下的设备/警报；**管理员/负责人**可查看所有或辖区内项目。 |
| U-4 | **密码修改/重置** | 必需 | 支持用户修改密码；忘记密码流程需通过手机验证码重置。 |
| U-5 | **用户管理与分配** | 必需 | 管理员可新增用户，并配置用户的**所属项目**（多对多关系，一个运维员可负责多个项目）。 |
| U-6 | **操作日志** | 中 | 系统需记录关键操作（如删除设备、修改项目信息、处理警报）的操作人、时间及IP，便于追责。 |

### 2.2 项目与设备管理模块 (Asset)

| ID | 功能名称 | 优先级 | 详细需求说明 |
| :--- | :--- | :--- | :--- |
| P-1 | **项目管理** | 必需 | 管理员可创建项目，录入项目中心点 GPS、围栏范围、负责人联系方式，支持在地图上选择水库位置。 |
| P-2 | **项目信息编辑** | 必需 | 管理员可新增/编辑项目名称、项目地址、项目负责人、联系方式等信息。 |
| P-3 | **设备批量录入** | **新增（可以预留，先不实现）** | 支持通过 Excel 模板批量导入设备 SN，或在小程序端支持**“连续扫码”**模式快速录入设备。 |
| P-4 | **设备全生命周期** | 优化 | 设备状态扩充：<br>- **待激活**：已录入但未上报过数据。<br>- **🟢 正常**：数据上报正常。<br>- **🔴 警报**：触发白蚁预警。<br>- **🟠 维护中**：低电量/故障/人工标记。<br>- **⚫ 离线**：超过 24h 未通信。<br>- **报废**：已拆除。 |
| P-5 | **设备绑定与安装** | 必需 | 运维员在现场安装时，通过地图打点修正设备坐标，并拍摄安装现场图上传。 |

### 2.3 地图可视化模块 (Map Visualization)

| ID | 功能名称 | 优先级 | 详细需求说明 |
| :--- | :--- | :--- | :--- |
| M-1 | **项目切换** | 必需 | 顶部 Tab 或下拉菜单，根据当前角色快速切换查看不同的水库项目地图。 |
| M-1 | **点聚合 (Clustering)** | **新增** | 当地图缩放级别较小时，将邻近的多个设备聚合显示为数字气泡（如“50”），防止图标重叠遮挡；放大后自动散开。 |
| M-2 | **状态筛选** | 优化 | 地图页提供浮层筛选器，可只显示“警报”或“离线”设备，快速定位问题。 |
| M-3 | **设备详情卡片** | 必需 | 点击设备展示：SN、电量、信号强度 (RSSI)、最后通信时间、当前状态。 |
| M-4 | **路径规划** | 必需 | 调用外部地图 App（高德/腾讯/百度）规划从当前位置到设备的步行/驾车路线。 |
| M-5 | **暗黑模式** | 体验 | 支持地图样式的日夜间切换，适应夜间巡检场景。 |

### 2.4 智能警报与处理模块 (Alert System)

| ID | 功能名称 | 优先级 | 详细需求说明 |
| :--- | :--- | :--- | :--- |
| A-1 | **实时警报推送** | 必需 | 当设备触发警报时，通过微信订阅消息+短信推送给对应项目的运维员。 |
| A-2 | **警报升级机制** | **新增** | 若警报触发超过 **24小时** 仍未被标记为“处理中”，系统自动推送通知给**项目负责人**，防止漏处理。 |
| A-3 | 警报详情 | 必需 | 展示警报设备 SN、所属项目、触发时间、警报时的设备电量/信号等关键数据。 |
| A-4 | **处理流程闭环** | 必需 | 待处理 -> 处理中（锁定） -> 已完成（填写结果）。<br>处理结果需包含：处理方式（多选：已更换诱饵/误报/环境干扰/其他）、现场照片（必填）、备注。 |
| A-5 | **误报智能分析** | 优化 | 若某设备在 7 天内连续被标记 3 次“误报”，系统自动生成“检修建议单”，提示更换设备或检查环境。 |
| A-6 | **离线缓存处理** | 体验 | 在无网络环境下，允许运维员先录入处理结果和照片，待网络恢复后自动同步上传。 |
| A-7 | **历史记录查询** | 必需 | 支持查询已处理警报的详细记录，包括处理人、处理时间、处理结果和图片。 |

### 2.5 统计报表模块 (Data Dashboard)

| ID | 功能名称 | 优先级 | 详细需求说明 |
| :--- | :--- | :--- | :--- |
| R-1 | **数据看板** | 必需 | 首页展示关键指标：总设备数、在线设备数、今日警报数、待处理警报数。 |
| R-2 | **警报趋势图** | 必需 | 按**周/月/季**统计警报数量，以柱状图或折线图展示趋势。支持按项目筛选。 |
| R-3 | **设备健康报告** | 必需 | 统计设备的平均**在线率**、**低电量设备**列表、**平均响应时间**（警报触发到开始处理的时间）。 |
| R-4 | **处理效率分析** | 必需 | 统计**平均处理时长**（开始处理到完成的时间），并对不同运维人员的处理效率进行排名。 |


-----

## 3. 技术架构与非功能需求

### 3.1 技术栈
*   **前端：** 微信小程序原生开发 (WXML/WXSS/JS)。
*   **后端：** Python (Flask) 。
*   **数据库：** MySQL (业务数据) + Redis (实时状态/缓存)。
*   **地图服务：** 腾讯地图 SDK (微信生态最佳兼容)。

### 3.2 性能指标
*   **并发量：** 支持 >1000 设备并发上报数据。
*   **实时性：** 警报从触发到推送到手机端延迟 < 5秒。
*   **加载速度：** 首屏地图加载耗时 < 2秒（利用本地缓存和分片加载）。

### 3.3 安全性
*   **通信加密：** 全程 HTTPS 传输。
*   **敏感数据：** 密码加盐 Hash 存储，用户手机号脱敏展示。
*   **接口鉴权：** 基于 Token (JWT) 的 API 访问控制。
*   **数据存储：** 所有警报、运维记录、图片资料需长期备份，并支持下载导出。
-----

## 4. 交互与UI建议
* **设计风格：** 采用简洁、专业的蓝色/绿色系 UI，符合工业或环境监测的主题。
* **重要操作：** 警报处理按钮必须醒目，防止误操作。
* **反馈机制：** 警报推送、操作成功/失败必须有明确的视觉和/或触觉反馈。
*   **色彩系统：**
    *   警报：`#FA5151` (红)
    *   正常：`#07C160` (绿)
    *   维护/低电：`#FFC300` (橙)
    *   离线：`#B2B2B2` (灰)
    *   主色调：`#1296DB` (科技蓝)
*   **导航结构：** 底部导航栏：[监测地图] - [实时警报] - [项目管理]- [数据报表] - [我的]。

-----

## 5. 新增项目页面信息的表单描述：
### 一、核心基础信息（必填项）

1. **水库类别**：单选按钮，默认选中 “单个水库”（另一个选项是 “多个水库集合”）
2. **水库名称**：输入框，提示 “请输入水库名称”
3. **水库类型**：下拉选择框，默认 “小（二）型”
4. **水库区域**：三级联动下拉框，选择地级市”
5. **联系人员**：双下拉选择，第一个选 “管理员”，第二个选 “当前项目负责人”

### 二、水库参数信息（非必填项）

1. **水库坝型**：下拉选择框，默认显示 “请选择大坝坝型”
2. **坝顶长度**：输入框，提示 “请输入长度 / 米”
3. **坝脚长度**：输入框，提示 “请输入长度 / 米”
4. **斜坡长度**：输入框，提示 “请输入长度 / 米”
5. **最大坝高**：输入框，提示 “请输入长度 / 米”
6. **水库地址**：输入框 +“选择” 按钮，提示 “请选择详细地址”
7. **经纬度**：输入框，提示 “经度 / 纬度”

### 三、管理与监测信息（非必填项）

1. **危害等级**：下拉选择框，提示 “请选择危害等级”
2. **检查方法**：单选按钮组，选项有 “人工法、引诱法、仪器探测法”（未选中）
3. **治理方法**：单选按钮组，选项有 “挖巢法、诱杀法、药杀法、药物灌浆法”（未选中）
4. **监测装置**：复选框组，当前选中 “白蚁智能监测装置”（其他选项：白蚁监测诱杀箱、智能成虫诱杀灯、普通成虫诱杀灯）


